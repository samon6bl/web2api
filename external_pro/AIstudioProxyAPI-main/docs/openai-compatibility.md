# OpenAI API å…¼å®¹æ€§è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ AI Studio Proxy API ä¸å®˜æ–¹ OpenAI API çš„å…¼å®¹æ€§ã€å·®å¼‚å’Œé™åˆ¶ã€‚

## æ¦‚è¿°

AI Studio Proxy API æ—¨åœ¨æä¾›ä¸ OpenAI API æœ€å¤§ç¨‹åº¦çš„å…¼å®¹æ€§ï¼Œä½¿ç°æœ‰ä½¿ç”¨ OpenAI SDK çš„åº”ç”¨å¯ä»¥æ— ç¼åˆ‡æ¢åˆ° Google AI Studioã€‚ä½†ç”±äºåº•å±‚å®ç°çš„å·®å¼‚ï¼ˆé€šè¿‡æµè§ˆå™¨è‡ªåŠ¨åŒ–è®¿é—® AI Studio Web UIï¼‰ï¼Œå­˜åœ¨ä¸€äº›ä¸å¯é¿å…çš„å·®å¼‚å’Œé™åˆ¶ã€‚

---

## æ”¯æŒçš„ç«¯ç‚¹

### âœ… å®Œå…¨æ”¯æŒ

| ç«¯ç‚¹                        | è¯´æ˜         | å…¼å®¹æ€§                            |
| --------------------------- | ------------ | --------------------------------- |
| `POST /v1/chat/completions` | èŠå¤©å®Œæˆæ¥å£ | å®Œå…¨å…¼å®¹ï¼Œæ”¯æŒæµå¼å’Œéæµå¼        |
| `GET /v1/models`            | æ¨¡å‹åˆ—è¡¨     | å®Œå…¨å…¼å®¹ï¼Œè¿”å› AI Studio å¯ç”¨æ¨¡å‹ |

### âš ï¸ éƒ¨åˆ†æ”¯æŒ

| ç«¯ç‚¹                        | è¯´æ˜         | å…¼å®¹æ€§                       |
| --------------------------- | ------------ | ---------------------------- |
| `GET /health`               | å¥åº·æ£€æŸ¥     | è‡ªå®šä¹‰ç«¯ç‚¹ï¼Œé OpenAI æ ‡å‡†   |
| `GET /api/info`             | API ä¿¡æ¯     | è‡ªå®šä¹‰ç«¯ç‚¹ï¼Œé OpenAI æ ‡å‡†   |
| `GET /v1/queue`             | é˜Ÿåˆ—çŠ¶æ€     | è‡ªå®šä¹‰ç«¯ç‚¹ï¼Œé OpenAI æ ‡å‡†   |
| `POST /v1/cancel/{req_id}`  | å–æ¶ˆè¯·æ±‚     | è‡ªå®šä¹‰ç«¯ç‚¹ï¼Œé OpenAI æ ‡å‡†   |
| `GET/POST/DELETE /api/keys` | API å¯†é’¥ç®¡ç† | è‡ªå®šä¹‰ç«¯ç‚¹ï¼Œç”¨äºç®¡ç†è®¿é—®å¯†é’¥ |

### âŒ ä¸æ”¯æŒ

- `POST /v1/embeddings` - åµŒå…¥å‘é‡ç”Ÿæˆ
- `POST /v1/images/generations` - å›¾åƒç”Ÿæˆ
- `POST /v1/audio/transcriptions` - éŸ³é¢‘è½¬å½•
- `POST /v1/audio/translations` - éŸ³é¢‘ç¿»è¯‘
- `POST /v1/audio/speech` - è¯­éŸ³åˆæˆ
- `POST /v1/files` - æ–‡ä»¶ä¸Šä¼ ç®¡ç†
- `POST /v1/fine-tuning/jobs` - å¾®è°ƒä»»åŠ¡

---

## `/v1/chat/completions` ç«¯ç‚¹è¯¦è§£

### æ”¯æŒçš„è¯·æ±‚å‚æ•°

#### âœ… å®Œå…¨æ”¯æŒ

| å‚æ•°                | ç±»å‹         | è¯´æ˜                 | å¤‡æ³¨                                          |
| ------------------- | ------------ | -------------------- | --------------------------------------------- |
| `messages`          | Array        | èŠå¤©æ¶ˆæ¯æ•°ç»„         | å¿…éœ€ï¼Œæ”¯æŒ `system`, `user`, `assistant` è§’è‰² |
| `model`             | String       | æ¨¡å‹ ID              | ç”¨äºåˆ‡æ¢ AI Studio ä¸­çš„æ¨¡å‹                   |
| `stream`            | Boolean      | æ˜¯å¦æµå¼è¾“å‡º         | æ”¯æŒ SSE (Server-Sent Events) æµå¼å“åº”        |
| `temperature`       | Number       | æ¸©åº¦å‚æ•° (0.0-2.0)   | é€šè¿‡ Playwright è®¾ç½® AI Studio é¡µé¢å‚æ•°       |
| `max_output_tokens` | Number       | æœ€å¤§è¾“å‡º token æ•°    | é€šè¿‡ Playwright è®¾ç½® AI Studio é¡µé¢å‚æ•°       |
| `top_p`             | Number       | Top-P é‡‡æ · (0.0-1.0) | é€šè¿‡ Playwright è®¾ç½® AI Studio é¡µé¢å‚æ•°       |
| `stop`              | Array/String | åœæ­¢åºåˆ—             | é€šè¿‡ Playwright è®¾ç½® AI Studio é¡µé¢å‚æ•°       |

#### âš ï¸ éƒ¨åˆ†æ”¯æŒ

| å‚æ•°               | ç±»å‹          | è¯´æ˜               | é™åˆ¶                                                                    |
| ------------------ | ------------- | ------------------ | ----------------------------------------------------------------------- |
| `reasoning_effort` | String/Number | æ€è€ƒæ¨¡å¼å’Œé¢„ç®—æ§åˆ¶ | è‡ªå®šä¹‰å‚æ•°ï¼Œæ”¯æŒ `"low"`, `"high"`, æ•°å€¼ï¼Œ`0` (å…³é—­)ï¼Œ`"none"` (ä¸é™åˆ¶) |
| `tools`            | Array         | å‡½æ•°è°ƒç”¨å·¥å…·å®šä¹‰   | æ”¯æŒ Google Search å·¥å…·ï¼Œè‡ªå®šä¹‰å·¥å…·æ”¯æŒæœ‰é™                             |
| `tool_choice`      | String/Object | å·¥å…·é€‰æ‹©ç­–ç•¥       | æ”¯æŒ `"auto"`, `"none"`                                                 |
| `response_format`  | Object        | å“åº”æ ¼å¼           | éƒ¨åˆ†æ”¯æŒï¼Œå–å†³äº AI Studio èƒ½åŠ›                                         |
| `seed`             | Number        | éšæœºç§å­           | æ¥å—ä½†å¯èƒ½ä¸ç”Ÿæ•ˆï¼ŒAI Studio ä¸ä¿è¯å¯é‡ç°æ€§                              |

#### ğŸ§© è‡ªå®šä¹‰æ‰©å±•å‚æ•°

| å‚æ•°           | ç±»å‹   | è¯´æ˜         |
| -------------- | ------ | ------------ | ----------------------------------------------------- |
| `attachments`  | Array  | é¡¶å±‚é™„ä»¶åˆ—è¡¨ | å…¼å®¹éƒ¨åˆ†ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ï¼Œæ”¯æŒ `data:`, `file:`, ç»å¯¹è·¯å¾„ |
| `mcp_endpoint` | String | MCP æœåŠ¡ç«¯ç‚¹ | ç”¨äºå°†å·¥å…·è°ƒç”¨å›é€€åˆ°æŒ‡å®šçš„ MCP æœåŠ¡                   |

#### âŒ ä¸æ”¯æŒæˆ–å¿½ç•¥

| å‚æ•°                | è¯´æ˜           | åŸå›              |
| ------------------- | -------------- | ---------------- |
| `frequency_penalty` | é¢‘ç‡æƒ©ç½š       | AI Studio ä¸æ”¯æŒ |
| `presence_penalty`  | å­˜åœ¨æƒ©ç½š       | AI Studio ä¸æ”¯æŒ |
| `logit_bias`        | Logit åå·®     | AI Studio ä¸æ”¯æŒ |
| `logprobs`          | è¿”å› log æ¦‚ç‡  | AI Studio ä¸æ”¯æŒ |
| `top_logprobs`      | Top N log æ¦‚ç‡ | AI Studio ä¸æ”¯æŒ |
| `n`                 | ç”Ÿæˆå¤šä¸ªå›å¤   | AI Studio ä¸æ”¯æŒ |
| `user`              | ç”¨æˆ·æ ‡è¯†ç¬¦     | æ¥å—ä½†å¿½ç•¥       |

### å“åº”æ ¼å¼

#### éæµå¼å“åº”

```json
{
  "id": "chatcmpl-1234567890-123",
  "object": "chat.completion",
  "created": 1699999999,
  "model": "gemini-1.5-pro",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "è¿™æ˜¯å“åº”å†…å®¹",
        "reasoning_content": "è¿™æ˜¯æ€è€ƒè¿‡ç¨‹ï¼ˆå¦‚æœ‰ï¼‰"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 10,
    "completion_tokens": 50,
    "total_tokens": 60
  },
  "system_fingerprint": "camoufox-proxy"
}
```

#### æµå¼å“åº” (SSE)

```
data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1699999999,"model":"gemini-1.5-pro","choices":[{"index":0,"delta":{"role":"assistant","content":"ä½ å¥½"},"finish_reason":null}]}

data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1699999999,"model":"gemini-1.5-pro","choices":[{"index":0,"delta":{"content":"ï¼"},"finish_reason":null}]}

data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1699999999,"model":"gemini-1.5-pro","choices":[{"index":0,"delta":{},"finish_reason":"stop"}],"usage":{"prompt_tokens":10,"completion_tokens":2,"total_tokens":12}}

data: [DONE]
```

---

## ä¸»è¦å·®å¼‚

### 1. å¹¶å‘å¤„ç†ä¸æ’é˜Ÿ (Sequential Processing)

**æœºåˆ¶**:

- æœ¬é¡¹ç›®ä½¿ç”¨**å•æµè§ˆå™¨å®ä¾‹**ä½œä¸ºåç«¯ï¼Œå› æ­¤æ‰€æœ‰è¯·æ±‚å¿…é¡»**æ’é˜Ÿé¡ºåºå¤„ç†**ã€‚
- ä¸æ”¯æŒçœŸæ­£çš„å¹¶è¡Œè¯·æ±‚å¤„ç†ã€‚å¦‚æœåŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œå®ƒä»¬ä¼šè¿›å…¥é˜Ÿåˆ—ç­‰å¾…ã€‚

**å½±å“**:

- **é«˜å¹¶å‘åœºæ™¯**: å“åº”æ—¶é—´ä¼šéšç€é˜Ÿåˆ—é•¿åº¦å¢åŠ è€Œæ˜¾è‘—å»¶é•¿ã€‚
- **æµå¼è¯·æ±‚**: å³ä½¿æ˜¯æµå¼è¯·æ±‚ï¼Œä¹Ÿéœ€è¦ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å®Œå…¨ç»“æŸï¼ˆåŒ…æ‹¬æµç»“æŸï¼‰åï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚æ‰èƒ½å¼€å§‹å¤„ç†ã€‚

**å»ºè®®**:

- é€‚åˆä¸ªäººä½¿ç”¨æˆ–ä½å¹¶å‘åœºæ™¯ã€‚
- ä¸é€‚åˆä½œä¸ºé«˜å¹¶å‘ç”Ÿäº§ç¯å¢ƒçš„åç«¯ã€‚

### 2. é€Ÿç‡é™åˆ¶ (Rate Limits)

**æœºåˆ¶**:

- é™åˆ¶æºäº **Google AI Studio ç½‘é¡µç‰ˆ** çš„è´¦æˆ·é™åˆ¶ï¼Œè€Œé OpenAI API çš„ Token é…é¢ã€‚
- é™åˆ¶é€šå¸¸åŸºäº Google è´¦å·çš„å•ä½æ—¶é—´è¯·æ±‚æ•°æˆ–è®¡ç®—èµ„æºä½¿ç”¨é‡ã€‚

**ç‰¹ç‚¹**:

- **æµè§ˆå™¨çº§é™åˆ¶**: å¦‚æœç½‘é¡µæç¤º "Too many requests" æˆ–è§¦å‘éªŒè¯ç ï¼ŒAPI ä¹Ÿä¼šå—åˆ°å½±å“ã€‚
- **è´¦å·ç›¸å…³**: é™åˆ¶ä¸ç™»å½•çš„ Google è´¦å·ç»‘å®šã€‚

### 3. å“åº”å»¶è¿Ÿ

**åŸå› **: é€šè¿‡æµè§ˆå™¨è‡ªåŠ¨åŒ–è®¿é—® AI Studioï¼Œå­˜åœ¨é¢å¤–çš„æ¸²æŸ“å’ŒDOMæ“ä½œå¼€é”€ã€‚

**å½±å“**:

- é¦–å­—èŠ‚æ—¶é—´ (TTFB) æ¯”å®˜æ–¹ API é•¿
- æµå¼å“åº”çš„åˆ†å—å¯èƒ½ä¸å¦‚å®˜æ–¹ API ç»†è…»

**ç¼“è§£æªæ–½**:

- ä½¿ç”¨é›†æˆæµå¼ä»£ç†æœåŠ¡ï¼ˆé»˜è®¤å¯ç”¨ï¼Œç«¯å£ 3120ï¼‰å¯æ˜¾è‘—å‡å°‘å»¶è¿Ÿ
- ä¸‰å±‚å“åº”è·å–æœºåˆ¶ç¡®ä¿åœ¨ä¸åŒåœºæ™¯ä¸‹çš„å¯ç”¨æ€§

### 4. Token è®¡æ•°

**åŸå› **: ä½¿ç”¨ç®€åŒ–çš„ token ä¼°ç®—ç®—æ³•ï¼ˆåŸºäºå­—ç¬¦æ•°å’Œ UTF-8 ç¼–ç ï¼‰ã€‚

**å½±å“**:

- `usage` å­—æ®µä¸­çš„ token æ•°é‡æ˜¯ä¼°ç®—å€¼ï¼Œå¯èƒ½ä¸å®é™…å€¼æœ‰åå·®
- è¯¯å·®é€šå¸¸åœ¨ Â±10% èŒƒå›´å†…

**æ³¨æ„äº‹é¡¹**:

- ä¸è¦ä¾èµ–ç²¾ç¡®çš„ token è®¡æ•°è¿›è¡Œè®¡è´¹
- ç”¨äºç›‘æ§å’Œè°ƒè¯•ç›®çš„å³å¯

### 5. æ€è€ƒå†…å®¹ (reasoning_content)

**æ‰©å±•å­—æ®µ**: é OpenAI æ ‡å‡†å­—æ®µï¼Œç”¨äºè¿”å› AI Studio çš„ "thinking" è¿‡ç¨‹ã€‚

**æ ¼å¼**:

```json
{
  "message": {
    "role": "assistant",
    "content": "æœ€ç»ˆå›ç­”",
    "reasoning_content": "æ€è€ƒè¿‡ç¨‹ï¼ˆå¦‚æœæ¨¡å‹æä¾›ï¼‰"
  }
}
```

**å…¼å®¹æ€§**: OpenAI SDK ä¼šå¿½ç•¥æœªçŸ¥å­—æ®µï¼Œä¸å½±å“æ­£å¸¸ä½¿ç”¨ã€‚

### 6. æ¨¡å‹åˆ‡æ¢

**è¡Œä¸º**: `model` å‚æ•°ç”¨äºåœ¨ AI Studio é¡µé¢åˆ‡æ¢æ¨¡å‹ã€‚

**é™åˆ¶**:

- æ¨¡å‹åˆ‡æ¢éœ€è¦æ—¶é—´ï¼ˆ2-5ç§’ï¼‰ï¼Œé¦–æ¬¡è¯·æ±‚ä¼šè¾ƒæ…¢
- æ¨¡å‹ ID å¿…é¡»å­˜åœ¨äº `/v1/models` è¿”å›çš„åˆ—è¡¨ä¸­
- ä¸æ”¯æŒåŒæ—¶ä½¿ç”¨å¤šä¸ªæ¨¡å‹ï¼ˆä¸æ”¯æŒ `n > 1`ï¼‰

**å»ºè®®**:

- ä½¿ç”¨ `excluded_models.txt` è¿‡æ»¤ä¸éœ€è¦çš„æ¨¡å‹
- è¿ç»­è¯·æ±‚ä½¿ç”¨ç›¸åŒæ¨¡å‹æ—¶æ€§èƒ½æ›´å¥½

### 7. å‡½æ•°è°ƒç”¨ (Function Calling)

**æ”¯æŒæƒ…å†µ**:

- âœ… æ”¯æŒ Google Search å·¥å…·ï¼ˆé€šè¿‡ AI Studio åŸç”Ÿèƒ½åŠ›ï¼‰
- âš ï¸ è‡ªå®šä¹‰å‡½æ•°éœ€è¦é€šè¿‡ MCP (Model Context Protocol) é€‚é…å™¨
- âŒ ä¸æ”¯æŒ OpenAI çš„åŸç”Ÿå‡½æ•°è°ƒç”¨æ ¼å¼çš„ç›´æ¥é€ä¼ 

**Google Search ç¤ºä¾‹**:

```json
{
  "tools": [
    {
      "type": "google_search"
    }
  ]
}
```

### 8. å‚æ•°æ§åˆ¶æœºåˆ¶

**ä¸‰å±‚å“åº”è·å–æœºåˆ¶**å¯¹å‚æ•°æ”¯æŒçš„å½±å“ï¼š

1. **é›†æˆæµå¼ä»£ç†æ¨¡å¼** (é»˜è®¤ï¼Œç«¯å£ 3120)
   - âœ… æ”¯æŒåŸºç¡€å‚æ•°ï¼š`model`, `temperature`, `max_tokens`
   - âš ï¸ éƒ¨åˆ†é«˜çº§å‚æ•°å¯èƒ½ä¸ç”Ÿæ•ˆ
   - âš¡ æ€§èƒ½æœ€ä¼˜ï¼Œå»¶è¿Ÿæœ€ä½

2. **å¤–éƒ¨ Helper æœåŠ¡æ¨¡å¼** (å¯é€‰é…ç½®)
   - å‚æ•°æ”¯æŒå–å†³äº Helper æœåŠ¡å®ç°
   - éœ€è¦æœ‰æ•ˆçš„è®¤è¯æ–‡ä»¶

3. **Playwright é¡µé¢äº¤äº’æ¨¡å¼** (åå¤‡æ–¹æ¡ˆ)
   - âœ… å®Œæ•´æ”¯æŒæ‰€æœ‰å‚æ•°
   - é€šè¿‡é¡µé¢æ“ä½œè®¾ç½®å‚æ•°
   - å»¶è¿Ÿè¾ƒé«˜ä½†åŠŸèƒ½å®Œæ•´

---

## å…¼å®¹æ€§æµ‹è¯•

### ä½¿ç”¨ OpenAI Python SDK

```python
from openai import OpenAI

# é…ç½®ä»£ç†
client = OpenAI(
    base_url="http://127.0.0.1:2048/v1",
    api_key="your-api-key-or-dummy"  # å¦‚æœæœåŠ¡å™¨ä¸éœ€è¦è®¤è¯ï¼Œå¯ä»¥æ˜¯ä»»æ„å€¼
)

# éæµå¼è¯·æ±‚
response = client.chat.completions.create(
    model="gemini-1.5-pro",
    messages=[
        {"role": "user", "content": "Hello!"}
    ]
)
print(response.choices[0].message.content)

# æµå¼è¯·æ±‚
stream = client.chat.completions.create(
    model="gemini-1.5-pro",
    messages=[
        {"role": "user", "content": "Tell me a story"}
    ],
    stream=True
)

for chunk in stream:
    if chunk.choices[0].delta.content:
        print(chunk.choices[0].delta.content, end="", flush=True)
```

### å®¢æˆ·ç«¯ç¤ºä¾‹ï¼šä½¿ç”¨ OpenAI Node.js SDK

```javascript
import OpenAI from "openai";

const client = new OpenAI({
  baseURL: "http://127.0.0.1:2048/v1",
  apiKey: "your-api-key-or-dummy",
});

// éæµå¼
const response = await client.chat.completions.create({
  model: "gemini-1.5-pro",
  messages: [{ role: "user", content: "Hello!" }],
});
console.log(response.choices[0].message.content);

// æµå¼
const stream = await client.chat.completions.create({
  model: "gemini-1.5-pro",
  messages: [{ role: "user", content: "Tell me a story" }],
  stream: true,
});

for await (const chunk of stream) {
  process.stdout.write(chunk.choices[0]?.delta?.content || "");
}
```

---

## å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1: æµå¼å“åº”ä¸­æ–­

**ç°è±¡**: SSE æµå¼å“åº”ä¸­é€”æ–­å¼€è¿æ¥ã€‚

**å¯èƒ½åŸå› **:

1. æµè§ˆå™¨é¡µé¢é”™è¯¯
2. AI Studio æœåŠ¡ä¸´æ—¶ä¸å¯ç”¨
3. ç½‘ç»œä»£ç†é…ç½®é—®é¢˜
4. æµå¼ä»£ç†æœåŠ¡å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**:

1. æ£€æŸ¥ `/health` ç«¯ç‚¹ç¡®è®¤æœåŠ¡çŠ¶æ€
2. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `logs/app.log`
3. å°è¯•ç¦ç”¨æµå¼ä»£ç†ï¼šåœ¨ `.env` ä¸­è®¾ç½® `STREAM_PORT=0`
4. æ£€æŸ¥ç½‘ç»œå’Œä»£ç†é…ç½®

### é—®é¢˜ 2: æ¨¡å‹åˆ—è¡¨ä¸ºç©º

**ç°è±¡**: `/v1/models` è¿”å›ç©ºåˆ—è¡¨æˆ–åªæœ‰é»˜è®¤æ¨¡å‹ã€‚

**å¯èƒ½åŸå› **:

1. AI Studio é¡µé¢æœªåŠ è½½å®Œæˆ
2. è®¤è¯æ–‡ä»¶è¿‡æœŸ
3. ç½‘ç»œæ‹¦æˆªå¤±è´¥
4. é¡µé¢ç»“æ„å˜åŒ–

**è§£å†³æ–¹æ¡ˆ**:

1. ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨ï¼ˆæŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼‰
2. æ›´æ–°è®¤è¯æ–‡ä»¶ï¼ˆä½¿ç”¨ `--debug` æ¨¡å¼é‡æ–°è®¤è¯ï¼‰
3. æ£€æŸ¥æµè§ˆå™¨è¿æ¥çŠ¶æ€
4. æŸ¥çœ‹ `errors_py/` ç›®å½•çš„é”™è¯¯å¿«ç…§

### é—®é¢˜ 3: å‚æ•°ä¸ç”Ÿæ•ˆ

**ç°è±¡**: è®¾ç½®çš„ `temperature`ã€`max_tokens` ç­‰å‚æ•°ä¼¼ä¹æ²¡æœ‰æ•ˆæœã€‚

**å¯èƒ½åŸå› **:

1. ä½¿ç”¨æµå¼ä»£ç†æ¨¡å¼ï¼Œå‚æ•°æœªé€ä¼ åˆ° AI Studio
2. AI Studio é¡µé¢çš„ "é«˜çº§é€‰é¡¹" æœªå±•å¼€
3. ç‰¹å®šæ¨¡å‹ä¸æ”¯æŒæŸäº›å‚æ•°

**è§£å†³æ–¹æ¡ˆ**:

1. ç¡®è®¤ `localStorage.isAdvancedOpen=true`ï¼ˆå¯åŠ¨æ—¶è‡ªåŠ¨è®¾ç½®ï¼‰
2. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å‚æ•°æ˜¯å¦æˆåŠŸè®¾ç½®
3. å°è¯•ç¦ç”¨æµå¼ä»£ç†ï¼Œä½¿ç”¨ Playwright æ¨¡å¼
4. å‚è€ƒ AI Studio å®˜æ–¹æ–‡æ¡£äº†è§£æ¨¡å‹é™åˆ¶

---

## æœ€ä½³å®è·µ

### 1. å®¢æˆ·ç«¯é…ç½®

**è®¾ç½®åˆç†çš„è¶…æ—¶**:

```python
client = OpenAI(
    base_url="http://127.0.0.1:2048/v1",
    api_key="your-api-key",
    timeout=60.0,  # ç§’ï¼Œæ ¹æ®éœ€è¦è°ƒæ•´
)
```

**å¤„ç†æµå¼å“åº”å¼‚å¸¸**:

```python
try:
    stream = client.chat.completions.create(..., stream=True)
    for chunk in stream:
        # å¤„ç†åˆ†å—
        pass
except Exception as e:
    print(f"Stream error: {e}")
    # å®ç°é‡è¯•é€»è¾‘
```

### 2. æ¨¡å‹é€‰æ‹©

**ä¼˜å…ˆä½¿ç”¨é«˜æ€§èƒ½æ¨¡å‹**:

- `gemini-1.5-flash` - å¿«é€Ÿå“åº”ï¼Œé€‚åˆå¯¹è¯
- `gemini-1.5-pro` - å¹³è¡¡æ€§èƒ½å’Œè´¨é‡
- `gemini-exp-*` - å®éªŒæ€§æ¨¡å‹ï¼ŒåŠŸèƒ½æœ€æ–°ä½†å¯èƒ½ä¸ç¨³å®š

**é¿å…é¢‘ç¹åˆ‡æ¢æ¨¡å‹**:

- æ¨¡å‹åˆ‡æ¢æœ‰å»¶è¿Ÿï¼Œå½±å“æ€§èƒ½
- åŒä¸€ä¼šè¯å°½é‡ä½¿ç”¨åŒä¸€æ¨¡å‹

### 3. é”™è¯¯å¤„ç†

**å®ç°é‡è¯•æœºåˆ¶**:

```python
from openai import OpenAI, APIError
import time

def chat_with_retry(client, messages, max_retries=3):
    for attempt in range(max_retries):
        try:
            return client.chat.completions.create(
                model="gemini-1.5-pro",
                messages=messages
            )
        except APIError as e:
            if attempt < max_retries - 1:
                time.sleep(2 ** attempt)  # æŒ‡æ•°é€€é¿
                continue
            raise
```

### 4. æ€§èƒ½ä¼˜åŒ–

**å¯ç”¨æµå¼ä»£ç†**:

```env
STREAM_PORT=3120  # é»˜è®¤å€¼ï¼Œç¡®ä¿å¯ç”¨
```

**åˆç†é…ç½®è¶…æ—¶**:

```env
RESPONSE_COMPLETION_TIMEOUT=300000  # 5åˆ†é’Ÿï¼Œæ ¹æ®éœ€è¦è°ƒæ•´
SILENCE_TIMEOUT_MS=60000  # 1åˆ†é’Ÿæ— è¾“å‡ºè¶…æ—¶
```

---

## ç›¸å…³æ–‡æ¡£

- [API ä½¿ç”¨æŒ‡å—](api-usage.md) - API ç«¯ç‚¹è¯¦ç»†è¯´æ˜
- [æµå¼å¤„ç†æ¨¡å¼è¯¦è§£](streaming-modes.md) - ä¸‰å±‚å“åº”è·å–æœºåˆ¶
- [ç¯å¢ƒå˜é‡é…ç½®æŒ‡å—](environment-configuration.md) - é…ç½®å‚æ•°è¯´æ˜
- [æ•…éšœæ’é™¤æŒ‡å—](troubleshooting.md) - å¸¸è§é—®é¢˜è§£å†³

---

å¦‚æœ‰ç–‘é—®æˆ–å‘ç°å…¼å®¹æ€§é—®é¢˜ï¼Œè¯·æäº¤ Issue åé¦ˆã€‚
